# Ransac算法设计总结
ransac算法在样本集中随机抽样出足够确定模型的样本点，根据样本集其他点到抽样模型的度量距离，判断该模型的质量好坏，在抽样足够多的次数后，可以认为质量最好的模型是我们所需要的模型。

## 1.基类的设计
因为比较常用的有对直线与圆进行拟合，而OpenCV内置了Ransac算法对特征点匹配进行筛选，而没有提供对直线与圆这种基本图形的拟合。所以可以自己设计一个基类。

* 在基类中抽象出所有的数据，以及整个算法的流程。
* 子类必须在构造函数中使用初始化列表完成对基类的初始化
* 对于不确定的部分封装成纯虚函数接口，子类在继承时必须实现纯虚函数，达到多态的效果。
* 在设计新的子类的时，只需要继承基类，提供构造函数，实现纯虚函数即可。

## 2.直线拟合
算法的原理听起来可能比较简单，但是完整的设计一个算法确实考虑很多细节问题，以下为几个比较重要的问题。
### 问题1：效率问题
测试案例为围绕直线 y=x 附近随机生成的30万个高斯分布点，拟合时间长。
解决办法：使用VS自带的性能探查器，对于CPU的使用率与函数的调用时间进行探查，针对用时长的代码块进行优化。

* 根据样本集的置信度和内点比例，为存放内点的容器预留内存，大幅减少vector容器动态扩容的时间。
* 在进行点到直线的距离计算时，由于距离公式的分母为根式，计算机对于根式是使用迭代法，且处于最内层的循环。但是它对于一条确定的直线来说是一个定值，所以可以将它提取到循环外部，减少计算量
* 将总的迭代次数分解成多个线程，为每个线程提供单独的最佳模型变量，避免使用互斥锁时，对共享资源进行频繁的数据访问造成的线程阻塞。
    * 创建线程的数量与数据量以及cpu核心数有关，

